<!DOCTYPE html>

{% extends "base.html" %}

{% block header_right %} 
   
    {% if user.is_authenticated %}

        <p style="text-align:right;padding-right:1em;">
            Mode: Single Player; &nbsp;&nbsp; Player: {{player}} <a href = "/accounts/logout"> &nbsp;&nbsp;logout </a>
        </p>

    {% endif %}
    
{% endblock %}

{% block sidebar %}

    <form action="/tictactoe/new_game/" method="post"> {% csrf_token %}
        <input style="border-width:7px;font-size:1.2em; padding-left:1.5em;padding-right:1.5em;border-radius:15px;font-style:italic" type="submit" name="reset" value="New Game">
    </form>

{% endblock %}

{% block extension %}

{% if user.is_authenticated %}

   {% if form.errors %}

      <p style="color: red;">Form Error: </p>
      <p {{form.errors}} </p>

   {% else %} 
     
      <style type="text/css"> 
          .ttt_button {
              width:2.3em;
              height:2.3em;
              text-align:center; 
              vertical-align:center; 
              display:inline-block; 
              font-size:2em;                                     
          } 

          #button_area {
              position:absolute; 
              left:30%;
              top:8em; 
              width:15em; 
              height:15em; 
              background:#EEEEEE;
          }
      </style>
   
      <div id = "button_area">
           <form action="" method="get"> {% csrf_token %}

           <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>

           <script type="text/javascript"> 

               // Check to see if JQuery loaded successfully
               if (!window.jQuery) {    
                   alert("JQuery not loaded");
               }

               //
               // The function to update buttons asynchronously
               //
               function send_to_server(key) {
                   // Send key pressed to the server
                   $.getJSON("/tictactoe/next_turn/", {key_pressed : key}, function(json) {
                       next_step = json['next_step'];
                       status = json['status'];

                       // Check to see if there is a next step. If there is, mark
                       // proper button with 'O'
                       if (next_step.length != 0) {
                           document.getElementsByName(next_step)[0].value="O"
                       }

                       if (status.toUpperCase() == "USERWON") {
                           alert("YOU WIN!");
                       } else if (status.toUpperCase() == "USERLOST") {
                           alert("YOU LOST!");
                       } else if (status.toUpperCase() == "DRAW") {
                           alert("DRAW");
                       }                       
                   });                 
                }
            </script>

            <input type="button" name="sqr1" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr1');}">
            <input type="button" name="sqr2" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr2');}">
            <input type="button" name="sqr3" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr3');}">
            <input type="button" name="sqr4" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr4');}">
            <input type="button" name="sqr5" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr5');}">
            <input type="button" name="sqr6" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr6');}">
            <input type="button" name="sqr7" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr7');}">
            <input type="button" name="sqr8" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr8');}">
            <input type="button" name="sqr9" class="ttt_button" value="" onClick="if (value.length == 0) {value='X'; send_to_server('sqr9');}">
          </form>
       </div>
 
   {% endif %}

   <script type="text/javascript">
      {% if status|upper == 'USERWON' %}
         alert ("You win!")                       
      {% elif status|upper == 'USERLOST' %}
         alert ("You lose!")
      {% elif status|upper == 'DRAW' %}
         alert ("Draw!")
      {% endif %}
   </script>
   
{% endif %}

{% endblock %}







