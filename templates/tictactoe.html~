<!DOCTYPE html>

{% extends "base.html" %}

{% block sidebar %}
   
    <form action="/tictactoe/new_game/" method="get"> {% csrf_token %}
        <input type="submit" class="sidebar_menu_button" name="new_game" value="New Game">
    </form>
    <form action="/tictactoe/history/" method="get"> {% csrf_token %}
        <input type="submit" class="sidebar_menu_button" name="history" value="Game History">
    </form>

{% endblock %}

{% block content %}

   {% if user.is_authenticated %} 

       {% if form.errors %}

          <p style="color: red;">Form Error: </p>
          <p {{form.errors}} </p>

       {% else %} 
   
            <style type="text/css"> 
       
              .ttt_button {
                  width:2.3em;
                  height:2.3em;
                  text-align:center; 
                  vertical-align:center; 
                  display:inline-block;
                  font-size:2em;                                                      
              } 

              #ttt_button_area {
                  position:absolute; 
                  left:31%;
                  top:9em; 
                  width:15em; 
                  height:15em;
                  background:#EEEEEE;
              }

             #ttt_status_area {
                  position:absolute;
                  left:31%;
                  top:21em;
                  width:15em;
                  height:auto;              
                  background:#EEEEEE;
                  padding-top: 0;
                  font-style:italic;
                  font-size:20px;
                  text-align:left;
                  padding-left:1em;
              }

              #ttt_score_area {
                  display:table;
                  float:right;
                  margin-top:3.5em;
                  margin-right:8em;               
                  width:15em;
                  height:10em;
                  text-align:center;
                  vertical-align:middle;
                  background:#EEEEEE;
                  border-radius:20px;
                  border-style:solid;
                  border-width:4px;
                  border-color:#888888;
                  box-shadow: 10px 10px 5px red;                                 
              }

              #ttt_inner_score_area {
                  display:table-cell;
                  vertical-align:middle;
              }
  
          </style>
        
          <div id = "ttt_button_area">

               <form action="" method="get"> {% csrf_token %}

               <script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
 
               <script type="text/javascript"> 

                   // Check to see if JQuery loaded successfully
                   if (!window.jQuery) {    
                       alert("JQuery not loaded");
                   }

                   //
                   // Update status panel with current status
                   //
                   function printStatus(status) {
                                        
                       document.getElementById("status_text").innerHTML = status;
                   }

                   //
                   // The function to update buttons asynchronously
                   //
                   function onTTTButtonClick(button_id) {

                       button = document.getElementById(button_id);
  
                       if (button.value.length == 0) {
                       
                           printStatus('Wait...');

                           // Mark the button clicked by the user with 'X'
                           button.value = 'X';

                           // Send key pressed to the server
                           $.getJSON("/tictactoe/next_turn/", {key_pressed : button_id}, function(json) {
                               status = json['status'];
                               next_step = json['next_step'];

                               // Check to see if there is a next step. If there is, mark
                               // proper button with 'O'
                               if (next_step.length != 0) {
                                   document.getElementById(next_step).value="O";
                               }

                               // Show a popup when the game is finished
                               if (status.toUpperCase() == "USERWON") {                               
                                   printStatus('Game Over: You Won');
                                   alert("You Win!");
                               } else if (status.toUpperCase() == "USERLOST") {
                                   printStatus('Game Over: You lost');
                                   alert("You Lose!");                               
                               } else if (status.toUpperCase() == "DRAW") {
                                   printStatus('Game Over: Draw');
                                   alert("Draw");                               
                               } else {
                                   printStatus('Your turn...'); 
                               }
                           });
                       }                                                      
                    }
 
                </script>

                <input type="button" name="sqr1" id="sqr1" class="ttt_button" value="" onClick="onTTTButtonClick('sqr1')">
                <input type="button" name="sqr2" id="sqr2" class="ttt_button" value="" onClick="onTTTButtonClick('sqr2')">
                <input type="button" name="sqr3" id="sqr3" class="ttt_button" value="" onClick="onTTTButtonClick('sqr3')">
                <input type="button" name="sqr4" id="sqr4" class="ttt_button" value="" onClick="onTTTButtonClick('sqr4')">
                <input type="button" name="sqr5" id="sqr5" class="ttt_button" value="" onClick="onTTTButtonClick('sqr5')">
                <input type="button" name="sqr6" id="sqr6" class="ttt_button" value="" onClick="onTTTButtonClick('sqr6')">
                <input type="button" name="sqr7" id="sqr7" class="ttt_button" value="" onClick="onTTTButtonClick('sqr7')">
                <input type="button" name="sqr8" id="sqr8" class="ttt_button" value="" onClick="onTTTButtonClick('sqr8')">
                <input type="button" name="sqr9" id="sqr9" class="ttt_button" value="" onClick="onTTTButtonClick('sqr9')">
              </form>
           </div>

           <div id = "ttt_status_area">
                   <span id = "status_text"> Your turn... </span>           
           </div>

           <div id = "ttt_score_area">
               <div id = "ttt_inner_score_area">
                   <p> You Win: {{you_win}} </p>
                   <p> Computer Wins: {{computer_wins}} </p>
               </div>
           </div>

       {% endif %}

    {% endif %}
   
{% endblock %}




